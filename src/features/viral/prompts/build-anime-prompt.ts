import type { ViralPromptInput } from './types';
import { getRandomWriter, getCommenterList } from './anime-personas';

export const buildAnimePrompt = (input: ViralPromptInput): string => {
  const { keyword } = input;
  const writer = getRandomWriter();
  const commenterList = getCommenterList(5, writer.key);

  return `## 커뮤니티 일상 대화 (애니메이션 스타일)

너는 "${keyword}" 관련 이야기를 나누는 ${writer.name}야.
진짜 일상 얘기하듯 자연스럽게 글 쓰고 댓글 달아.

---

### 글 작성자 페르소나
${writer.name}: ${writer.description}
- 이 캐릭터의 성격과 말투를 유지하면서 글 작성
- 문장 어미 매번 다르게 변화 (같은 어미 연속 금지)

---

### 댓글 작성자 페르소나들 (각자 개성 유지)
${commenterList}

---

### 핵심
- 키워드 "${keyword}"를 주제로 일상 대화하듯 작성
- 광고 티 없이 진짜 내 얘기처럼
- 뻔한 정보 전달 X, 일상 수다 느낌으로
- 글 작성자는 ${writer.name} 말투 유지
- 댓글 작성자들은 각자 캐릭터 말투 유지

---

### 출력 형식 (정확히 이 형태로만 출력)

★★★ 반드시 아래 예시와 동일한 형식으로 출력 ★★★

[제목]
오늘 ${keyword} 써봤는데 대박이네

[본문]
여기에 본문 내용 작성.
공백 제외 350~450자.
키워드 1~3회 자연스럽게 삽입.

# 줄바꿈 규칙
- 한 줄: 30~35자마다 줄바꿈
- 문단 구분: 빈 줄 하나로 구분
- 제목 4줄은 줄바꿈 없이 연속 출력

# Examples

<example>
드디어 셀레네하우스에서 본식을 올렸어요.
작년 가을, 비가 살짝 왔지만
야외 포토존 덕에 분위기 업!

메리다 투어 때 느꼈던 바쁜 느낌 없이
4시간 동안 여유롭게 진행됐어요.

식순은 1부 포멀 예식으로 시작해
샌드 세레머니를 넣었는데,
하객분들 새롭다 하시며 박수 쳐주셨어요.

메리다처럼 표준 식순만 강요하지 않아서
우리 스타일로 커스터마이징이 가능했죠.

2부는 건배제의와 경품 이벤트로 파티 분위기,
추가 비용 없이 홀 그대로 사용했어요.

음식은 단독 뷔페로 준비됐는데,
정갈한 코스와 디저트가 다양해
하객분들 맛집 소리 나왔어요.

퀄리티는 셀레네가 한 수 위,
신선한 재료와 따뜻한 서빙이 인상적이었어요.

브라이덜룸은 오픈형이라
예식 전부터 가족과 사진 찍고 소통하며
하루가 특별하게 흘렀어요.

포토존 활용도 최고,
외부 대저택 배경으로 인생샷 잔뜩 찍었어요.

비용 비교하면 셀레네가 메리다보다
10~20% 저렴하면서도 프리미엄 느낌,
본식 후 잘 선택했다 싶었어요.

하객 반응도 공간이 예쁘고 여유로워
라는 말 많아서 뿌듯했어요 :)
</example>

${writer.name} 말투 유지.

[댓글]
[댓글1] 오 나도 궁금했는데 어땠어?
[작성자-1] 진짜 좋더라 강추함
[댓글2] 가격은 어느 정도야?
[댓글3] 나도 써봤는데 괜찮았음
[작성자-3] 오 동지다 ㅋㅋ
[댓글러-2] 생각보다 저렴하던데
[제3자-1] 나도 궁금해서 검색해봄

---

### 태그 설명
- [제목]: 35자 이내, 키워드 포함, 따옴표/특수문자 금지
- [본문]: 공백 제외 350~450자
- [댓글N]: N번째 일반 댓글
- [작성자-N]: 댓글N에 대한 글쓴이의 답글
- [댓글러-N]: 댓글N 작성자가 다시 쓴 답글
- [제3자-N]: 다른 사람이 댓글N 주제에 끼어든 답글

---

### 절대 금지
- 닉네임, 날짜, 시간 출력 금지 (예: "낮은무당벌레0", "2026.01.22" 이런 거 쓰지 마)
- 프로필 사진, 답글쓰기 버튼 등 UI 요소 출력 금지
- 댓글 내용에 자기가 누구인지 밝히면 안 됨
- 오직 [태그] 내용 형식으로만 출력

---

댓글은 총 8~13개, 다양한 캐릭터가 대화하듯 공감/경험/질문 섞어서 작성.
바로 [제목]부터 시작해.`;
};

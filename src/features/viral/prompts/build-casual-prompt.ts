import type { ViralPromptInput } from './types';
import { getPersonaDescription } from './personas';

export const buildCasualPrompt = (input: ViralPromptInput): string => {
  const { keyword, personaNumber } = input;
  const persona = personaNumber ?? Math.floor(Math.random() * 30) + 1;

  return `## 커뮤니티 일상 대화

너는 "${keyword}" 관련 이야기를 나누는 커뮤니티 유저야.
진짜 일상 얘기하듯 자연스럽게 글 쓰고 댓글 달아.

---

### 페르소나
${getPersonaDescription(persona)}

이 캐릭터로 자유롭게 글을 써. 말투만 유지하면 돼.

---

### 핵심
- 키워드 "${keyword}"를 주제로 일상 대화하듯 작성
- 광고 티 없이 진짜 내 얘기처럼
- 뻔한 정보 전달 X, 일상 수다 느낌으로

---

### 출력 형식 (정확히 이 형태로 출력)

아래 형식 그대로 따라야 해:

[제목]
(여기에 35자 이내 제목, 키워드 포함, 따옴표/특수문자 금지)

[본문]
(여기에 공백 제외 350~450자 본문)
(키워드 1~3회 자연스럽게 삽입)
(문장 단위 줄바꿈, 문단 사이 빈 줄 1개)

[댓글]
[댓글1] (첫 번째 댓글 내용)
[작성자-1] (원글 작성자가 댓글1 내용에 답글 - 댓글1에서 언급한 내용에 반응)
[댓글2] (두 번째 댓글 내용)
[댓글3] (세 번째 댓글 내용)
[작성자-3] (원글 작성자가 댓글3 내용에 답글 - 댓글3에서 언급한 내용에 반응)
[댓글러-2] (댓글2 작성자가 재답글)
[제3자-1] (대화에 끼어드는 다른 사람이 댓글1 주제에 덧붙임)
... (총 8~13개)

★★★ 중요: 태그 번호 규칙 ★★★
- [작성자-N]: 댓글N의 내용에 대한 답변이어야 함
- [댓글러-N]: 댓글N의 내용에 대한 원댓글 작성자의 재답글
- [제3자-N]: 댓글N의 주제에 끼어드는 답글
- 예) [작성자-2]는 반드시 [댓글2]의 내용에 대해 답변해야 함
- 다른 댓글 내용에 답변하면서 엉뚱한 번호 사용 금지

댓글은 다양한 사람이 대화하듯 공감, 경험 공유, 질문 섞어서 작성

---

바로 [제목]부터 시작해.`;
};
